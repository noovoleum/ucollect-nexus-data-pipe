{
  "pipeline": {
    "name": "mongodb-to-postgresql-advanced-mapping"
  },
  "source": {
    "type": "mongodb",
    "settings": {
      "uri": "mongodb://localhost:27017",
      "database": "mydb",
      "collection": "users"
    }
  },
  "sink": {
    "type": "postgresql",
    "settings": {
      "connection_string": "host=localhost port=5432 user=postgres password=postgres dbname=mydb sslmode=disable",
      "table": "users"
    }
  },
  "transformer": {
    "type": "fieldmapper",
    "settings": {
      "mappings": [
        {
          "source": "profile",
          "nested_path": "profile.email",
          "destination": "email",
          "format": "lowercase"
        },
        {
          "source": "profile",
          "nested_path": "profile.firstName",
          "destination": "first_name",
          "format": "titlecase"
        },
        {
          "source": "profile",
          "nested_path": "profile.lastName",
          "destination": "last_name",
          "format": "titlecase"
        },
        {
          "source": "address",
          "nested_path": "address.city",
          "destination": "city"
        },
        {
          "source": "address",
          "nested_path": "address.zipcode",
          "destination": "zip_code"
        },
        {
          "source": "settings",
          "nested_path": "settings.notifications.enabled",
          "destination": "notifications_enabled",
          "format": "bool",
          "default": "false"
        },
        {
          "source": "settings",
          "nested_path": "settings.newsletter.subscribed",
          "destination": "newsletter_subscribed",
          "format": "bool",
          "default": "false"
        },
        {
          "source": "profile",
          "nested_path": "profile.email",
          "destination": "username",
          "extract": "^([^@]+)@"
        },
        {
          "source": "createdAt",
          "destination": "created_at",
          "format": "date"
        },
        {
          "source": "status",
          "destination": "status",
          "default": "active",
          "format": "lowercase"
        }
      ],
      "include_all": false,
      "strict_mode": false
    }
  }
}
